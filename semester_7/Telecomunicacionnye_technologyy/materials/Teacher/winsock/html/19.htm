<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0046)http://doc.mpv.ru/steps/mfc/net/socket/19.html -->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=koi8-r">
<META content="MSHTML 6.00.2900.2180" name=GENERATOR></HEAD>
<BODY text=black vLink=blue aLink=red link=blue bgColor=white><LINK 
href="19.files/1.css" type=text/css rel=stylesheet><FONT color=red>
<H2 align=center>Шаг 19 - Получение своего IP адреса.</H2></FONT>
<P>Итак, задача получить свой <B>IP</B> адрес. Для начала надо получить имя 
локального хоста. Мы это делали. "<A 
href="http://doc.mpv.ru/steps/mfc/net/socket/3.html">Шаг 3 - Получение имени 
хоста</A>" имея имя хоста можно получить <B>IP</B> адрес, воспользовавшись 
функцией <B>gethostbyname()</B>. Давайте посмотрим: <PRE>// TestB.cpp : Defines the entry point for the console application.
//
#include "stdafx.h"
#include "winsock2.h"
#include "iostream.h"

#pragma comment(lib,"wsock32.lib")

void main()
{
	WSADATA wsaData;
	if (!WSAStartup(WINSOCK_VERSION, &amp;wsaData)) 
	{
	char chInfo[64];
	if (!gethostname(chInfo,sizeof(chInfo)))
	{
	  cout &lt;&lt; chInfo &lt;&lt; endl;
	  hostent *sh;
	  sh=gethostbyname((char*)&amp;chInfo);
	  if (sh!=NULL)
	  {
	  cout &lt;&lt; sh-&gt;h_name &lt;&lt; endl;
	  int   nAdapter = 0;
		while (	sh-&gt;h_addr_list[nAdapter]  )
		{
			struct   sockaddr_in   adr;
			memcpy(&amp;adr.sin_addr,sh-&gt;h_addr_list[nAdapter],sh-&gt;h_length); 
			cout &lt;&lt; inet_ntoa(adr.sin_addr) &lt;&lt; endl;
			nAdapter++;
		}
	  }
	}
	else cout &lt;&lt; "Error local host " &lt;&lt; endl;
	}
	else cout &lt;&lt; "Winsock initial Bad !!!!" &lt;&lt; endl;
	WSACleanup();
}
</PRE>
<P>Ничего особенного кроме того, что <B>h_addr_list</B> - это указатель на 
массив указателей адресов и адрес нужно преобразовать в привычный вид через 
<B>inet_ntoa()</B>. 
<P>
<HR>

<CENTER><FONT size=2><A 
href="http://doc.mpv.ru/steps/mfc/net/socket/18.html">Предыдущий шаг</A> | <A 
href="http://doc.mpv.ru/steps/mfc/net/socket/20.html">Следующий Шаг</A> | <A 
href="http://doc.mpv.ru/steps/mfc/net/socket/socket.html">Оглавление</A></FONT></CENTER>
<HR>

<CENTER><FONT size=2>By <A href="mailto:kaev@yandex.ru">Artem</A>.</CENTER>
<SCRIPT src="19.files/banners.htm"></SCRIPT>
<!-- ><!-- "><!-- '><!-- --></TEXTAREA></FORM></TITLE></COMMENT></A>
<DIV></DIV></SPAN></ILAYER></LAYER></IFRAME></NOFRAMES></STYLE></NOSCRIPT></TABLE></SCRIPT></APPLET></FONT>
<STYLE>#bn {
	DISPLAY: block
}
#bt {
	DISPLAY: block
}
</STYLE>
</BODY></HTML>
