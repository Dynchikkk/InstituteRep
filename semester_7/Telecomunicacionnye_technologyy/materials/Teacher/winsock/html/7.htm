<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0045)http://doc.mpv.ru/steps/mfc/net/socket/7.html -->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=koi8-r">
<META content="MSHTML 6.00.2900.2180" name=GENERATOR></HEAD>
<BODY text=black vLink=blue aLink=red link=blue bgColor=white><LINK 
href="7.files/1.css" type=text/css rel=stylesheet><FONT color=red>
<H2 align=center>Шаг 7 - Ожидающий сокет</H2></FONT>Выносим предыдущий шаг в 
отдельную функцию. <PRE>.....
void LinkWindowScoket();
.....
</PRE>После всех настроек есть возможность установить сокет в состояние 
ожидания. Это делается командой <B>listen</B>. Вот весь код. <PRE>void WaitSocket()
{
	SocketGetHostName();
	CreateSocket();
	LinkSoketPort();
        LinkWindowScoket();
	int Errors;
	Errors=listen(servsocket,QUEUE_SIZE);
	if ( Errors == SOCKET_ERROR)
	{
		printf(" Listen BAD !!! \n");
		exit(1);
	}
	else printf("God Listen  !!!!!!! \n");
	printf("Wait to connected");

	CloseScoket();
}
</PRE>Некоторая специфика приложения <B>Win32 Console</B> на данный момент не 
даст возможность послушать по человечески. Нам в следующих шагах придется 
научить получать сообщения от <B>Windows</B> и их обрабатывать. Но при 
программировании на базе, скажем, <B>MFC</B> этого было бы достаточно, чтобы 
сразу перейти к обработке сообщений. А пока мы увидим, что всё нормально и 
программа завершит работу. 
<P>Итак функция <B>listen</B> переводит сокет в режим ожидания. <PRE>int listen (  
      SOCKET s,
      int backlog  
);
</PRE>Первый параметр это созданный сокет, а второй максимальное количество 
подключений. Я пока оставил <B>5</B> определив константу <B>QUEUE_SIZE</B> <PRE>#define QUEUE_SIZE 5
</PRE>При нормальном завершении функция вернет <B>0</B> иначе 
<B>SOCKET_ERROR</B>, кстати я ни разу вроде не сказал, но расширенный код ошибки 
можно получить вызвав функцию <B>WSAGetLastError</B>. 
<P>
<HR>

<CENTER><FONT size=2><A 
href="http://doc.mpv.ru/steps/mfc/net/socket/prog/step7.rar">Загрузить 
проект</A> | <A href="http://doc.mpv.ru/steps/mfc/net/socket/6.html">Предыдущий 
шаг</A> | <A href="http://doc.mpv.ru/steps/mfc/net/socket/8.html">Следующий 
Шаг</A> | <A 
href="http://doc.mpv.ru/steps/mfc/net/socket/socket.html">Оглавление</A></FONT></CENTER>
<HR>

<CENTER><FONT size=2>By <A href="mailto:kaev@yandex.ru">Artem</A>.</CENTER>
<SCRIPT src="7.files/banners.htm"></SCRIPT>
<!-- ><!-- "><!-- '><!-- --></TEXTAREA></FORM></TITLE></COMMENT></A>
<DIV></DIV></SPAN></ILAYER></LAYER></IFRAME></NOFRAMES></STYLE></NOSCRIPT></TABLE></SCRIPT></APPLET></FONT>
<STYLE>#bn {
	DISPLAY: block
}
#bt {
	DISPLAY: block
}
</STYLE>
</BODY></HTML>
