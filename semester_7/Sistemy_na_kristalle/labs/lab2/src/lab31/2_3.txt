; Регистры:
; s0 = сумма
; s1 = текущие значения тумблеров (SW)
; s2 = текущее состояние кнопок  
; s3 = предыдущее состояние кнопок

start:
    ; Инициализация
    LOAD s0, 00        ; обнуляем сумму
    LOAD s3, 00        ; обнуляем предыдущие состояния кнопок

main_loop:
    ; Чтение входных данных
    INPUT s1, 01       ; s1 <- SW (порт 1) 
    INPUT s2, 02       ; s2 <- BTN (порт 2)
    
    ; Проверка BTN3 (сложение при отпускании)
    CALL check_btn3
    
    ; Проверка BTN1 (сброс при отпускании)  
    CALL check_btn1
    
    ; Вывод текущей суммы
    OUTPUT s0, 00      ; вывод суммы на порт 0 (LED)
    
    ; Сохраняем текущее состояние кнопок
    LOAD s3, s2
    
    JUMP main_loop

; Подпрограмма проверки BTN3 (сложение)
check_btn3:
    TEST s3, 08        ; проверяем бит 3 (BTN3) в предыдущем состоянии
    JUMP Z, btn3_done  
    TEST s2, 08        ; проверяем бит 3 (BTN3) в текущем состоянии  
    JUMP NZ, btn3_done 
    ADD s0, s1         ; добавляем значение SW к сумме
btn3_done:
    RETURN

; Подпрограмма проверки BTN1 (сброс)
check_btn1:
    TEST s3, 02        ; проверяем бит 1 (BTN1) в предыдущем состоянии
    JUMP Z, btn1_done  
    TEST s2, 02        ; проверяем бит 1 (BTN1) в текущем состоянии
    JUMP NZ, btn1_done 
    LOAD s0, 00        ; обнуляем сумму
btn1_done:
    RETURN