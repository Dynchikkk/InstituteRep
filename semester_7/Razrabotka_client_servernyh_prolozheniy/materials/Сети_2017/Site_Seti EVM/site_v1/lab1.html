<html>
<head>
<title>Lab 1</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<style fprolloverstyle>A:hover {color: #FF0000}</style>
</head>
<body text=black bgcolor=#ffffff vlink=black link=black>
<!---------------- Title ------------>
<table border=0 CELLSPACING=0 cellpadding=0 width=99%>
<tr>
	<td align=center bgcolor=#FF9090><font color=white><big><b>Сети ЭВМ</td>
</tr>
</table>
<hr color=red size=1 width=99%>
<!---------------- Title Ends ------->
<br>
<!---------------- Nav Bar    ------->
<table width=99% cols=2 CELLSPACING=0 cellpadding=0>
<tr><td valign=top width=150>
    	<table width=140 CELLSPACING=0 cellpadding=5 border=1 bordercolor=red bordercolordark=white>
		<tr><td bgcolor=#FFe0E0><font size=-1><b><A href=lab1.html>Лабор. работа №1</A></td></tr>
		<tr><td><font size=-1><A href=lab2.html>Лабор. работа №2</A></td></tr>
		<tr><td bgcolor=#FFE0E0><font size=-1><A href=lab3.html>Лабор. работа №3</A></td></tr>
		<tr><td><font size=-1><A href=lab4.html>Лабор. работа №4</A></td></tr>
		<tr><td bgcolor=#FFE0E0><font size=-1><A href=cont_l2.html>Документация</A></td></tr>
		<tr><td><font size=-1><A href=arch.html>Архив</A></td></tr>
		<tr><td bgcolor=#FFE0E0><font size=-1><A href=vopr.html>Вопросы</A></td></tr>
	</td></tr>
	</table>
    </td>
    <td valign=top>
<!------------ Main Text ----- width=550 ------>
<CENTER><B><I><FONT SIZE=+1>Лабораторная работа №1</FONT></I></B>
<hr color=red size=1 width=70%>
Разработка и отладка программ клиента и сервера в архитектуре взаимодействия “клиент - сервер” с использованием семейства протоколов TCP/IP.</center>
<BR>
<BR>
<TABLE BORDER=0 WIDTH="99%" BGCOLOR="#FFE0E0"><TR><TD>Цель работы</TD></TR></TABLE>

<P>
Изучение протоколов семейства <A HREF="transport.htm" target="main">TCP/IP</A>, функций и методов стандарта <A HREF="sockets1.htm" target="main">WINSOCK</A>, определяющего сетевой интерфейс для программирования сокетов в ОС Microsoft Windows 2000/XP. Разработка программы-клиента и программы-сервера в архитектуре взаимодействия “клиент-сервер” с использованием семейства протоколов TCP/IP. 

<BR>&nbsp;
<TABLE BORDER=0 WIDTH="99%" BGCOLOR="#FFE0E0"><TR><TD>Задание</TD></TR></TABLE>
<BR>


<b>Разработать программу клиента, которая должна:</b>
<BR>- запрашивать у пользователя адрес программы-сервера;
<BR>- устанавливать соединение с сервером;
<BR>- передавать на сервер данные;
<BR>- принимать ответ от сервера и выводить его на экран;
<BR>- закрывать соединение с сервером.
<BR>&nbsp;
<BR>
<b>Разработать программу сервера, которая должна: </b>
<BR>- ожидать запросов от программ клиентов на соединение; 
<BR>- устанавливать соединение с клиентами; 
<BR>- принимать данные от клиентов и выполнять их обработку; 
<BR>- пересылать результат обработки клиенту.
<BR>&nbsp;


<TABLE BORDER=0 WIDTH="99%" BGCOLOR="#FFE0E0"><TR><TD>Алгоритм работы программы-клиента</TD></TR></TABLE>

<p>Для того, чтобы установить связь с процессом, выполняющимся на другой ЭВМ, клиентская программа должна создать сокет. Сокет в любой современной системе представляет собой особый вид файла, из которого можно читать и в которой можно записывать двоичные данные. При операциях обмена с сокетом нет никакого контроля типов, эта задача возлагается на приложения. На <A HREF="img/algorithm.gif">схеме
алгоритма</A> блок “Создание сокета” подразумевает вызов функции  <A HREF="sockets1.htm#socket" target="main">socket</A>, который в случае успеха создает сокет – потоковое или дейтаграммное – и семейство протоколов. В данном случае создается потоковый сокет и используется семейство протоколов TCP/IP. <BR>
Установка соединения с другим процессом заключается в обмене специальными пакетами и возможно только тогда, когда тот процесс ожидает приема соединений.  В противном случае, результат операции будет неудачным  и будет получено сообщение о том, что-либо не удалось установить соединение, либо оно было разорвано (зависит от реализации). Для установки соединения требуется указать ЭВМ по IP-адресу или по доменному имени, которое обязательно должно быть преобразовано в IP-адрес, и процесс на этой ЭВМ (по целочисленному идентификатору, называемому портом). Все это реализуется при помощи функции <A HREF="sockets1.htm#connect" target="main">connect</A>. Если соединение успешно установлено, то сразу после вызова этой функции можно вести обмен с гарантированной  доставкой пакетов. В противном случае работа невозможна. <BR>
Разрыв соединения означает обмен специальными пакетами и может производиться при помощи системного вызова close. Функция <A HREF="sockets1.htm#close" target="main">close</A> уничтожает сокет, делая его непригодным к использованию (любая операция с ним будет заканчиваться неудачей).
<BR><BR>
<TABLE BORDER=0 WIDTH="99%" BGCOLOR="#FFE0E0"><TR><TD>Алгоритм работы программы-сервера</TD></TR></TABLE>
<p>
Основной задачей серверной части является обработка. Обмен данными с клиентскими процессами есть важная составляющая часть этой задачи. 
 Для того, чтобы процессы-клиенты могли связаться с сервером, сервер создает сокет для обмена данными. На <A HREF="img/algorithm.gif">схеме
алгоритма</A>  это представлено блоком “Создание сокета”.  Производится так же, как и в клиентской программе. <br>
Следующий блок – “Получение локального адреса” – принципиально важен. Он служит для того, чтобы все запросы на соединения, приходящие на данную ЭВМ и обращающиеся к указанному порту, операционная система направляла данному процессу. Операция производится посредством  системного вызова <A HREF="sockets1.htm#bind">bind</A>, в котором указывается созданный ранее сокет, IP–адрес ЭВМ (как правило, это константа 0) и идентификатор процесса, т. е. порт. После этого, разумеется, в случае успеха, программа сервера вызывает функцию <A HREF="sockets1.htm#listen">listen</A>, которая говорит операционной системе о том, что процесс ожидает поступления запросов на соединение на данный сокет и, что эти запросы нужно ставить в очередь указанной длины (в штуках). <br>
Получение запроса на соединение происходит тогда, когда клиентский процесс вошел в блок  “Установка соединения”, т. е. вызвал функцию  <A HREF="sockets1.htm#connect">connect</A>. ОС сервера при этом создает копию сокета, чтобы программа могла на первом экземпляре продолжить работу, а на другом – вести обмен с подключившимся клиентом. Следующий блок – “Создание нового потока” – подразумевает порождения новой параллельной ветки программы, которая будет вести обработку данных. В системах Windows это обычно нить (thread), создаваемая при помощи функции _beginthread, в  UNIX-системах это новый процесс, создаваемый при помощи вызова fork. 
По окончании работы  с клиентом серверный процесс закрывает свою копию сокета и уничтожается.
</p>
<TABLE BORDER=0 WIDTH="99%" BGCOLOR="#FFE0E0"><TR><TD>Порядок выполнения лабораторной работы</TD></TR></TABLE>

<b>Загрузка, компилирование и выполнение проекта:</b><br>
1. Запустить <i>Microsoft Visual Studio 2005</i>. <br>
2. Выбрать в главном меню <i>File->Open->Project/Solution</i>. <br>
3. Указать путь к файлу <i>lab_1.sln</i> и далее нажать кнопку <i>Open</i>.  <br>
4. Слева в окне выбрать вкладку <i>Solution Explorer</i>. Все файлы проекта будут представлены в этом окне. Двойное нажатие левой кнопкой мыши на файле откроет его для редактирования в основной области экрана.<br>
<center><br>
 <IMG SRC="img/pic_1_Solution.JPG" ><br>
<b>Рисунок 1. Окно Solution Explorer</b>
</center><br>
5.Нажать кнопку <i>F7</i>. Проект будет откомпилирован целиком. Внизу в окне <i>Output</i> будет представлен отчет.<br> 
<center><br>
 <IMG SRC="img/pic_1_output.JPG" ><br>
<b>Рисунок 2. Окно Output</b>
</center><br>


Обратите внимание на последнюю строчку в проекте, в ней приведены результаты компиляции:<br><br>
<i>========== Build: 2 succeeded, 0 failed, 0 up-to-date, 0 skipped ==========</i><br>
<br>
6. В папке <i>Debug</i> (или <i>Release</i>) будут созданы исполняемые файлы программ: <i>server.exe</i> – программа-сервер, <i>client.exe</i> – программа-клиент.<br>

<br><TABLE BORDER=0 WIDTH="99%" BGCOLOR="#FFE0E0"><TR><TD>Описание работы программ</TD></TR></TABLE><br>

<b>Программа-сервер<br></b><p>
После запуска сервера, программа автоматически перейдет в режим ожидания соединения от клиента. Никаких действий более выполнять не требуется. Для выхода из программы использовать комбинацию клавиш CTRL+C. После подключения клиента в окне программы отобразится его ip-адрес. А после отправки сообщения клиентом в окне сервера появится принятая информация.<br>
 
<center><br>
 <IMG SRC="img/pic_1_server.JPG" ><br>
<b>Рисунок 3. Работа сервера</b>
</center><br>


<b>Программа-клиент<br></b><p>
После запуска программы необходимо указать ip-адрес сервера, или нажать клавишу Enter, тогда в качестве ip-адреса будет использоваться локальный адрес <i>(127.0.0.1)</i>. После соединения с сервером необходимо ввести сообщение и нажать клавишу Enter для отправки. После этого от сервера придет подтверждение принятия сообщения. На этом работа клиента будет завершена.<br>
 
<center><br>
 <IMG SRC="img/pic_1_client.JPG" ><br>
<b>Рисунок 4. Работа клиента</b>
</center><br>


    </td>
</tr>
</table>
<hr size=1 color=red width=100%>
<table width=99% cellspacing=0 cellpadding=0><tr><td bgcolor=#FF9090><font color=white>&nbsp;&copy Пензенский Госудрственный Университет. 2009 г.</td>
</tr>
</td></tr>
</table>
</body>
</html>