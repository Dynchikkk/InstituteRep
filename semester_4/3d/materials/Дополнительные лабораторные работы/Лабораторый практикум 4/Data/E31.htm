<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Аффинные преобразования на плоскости</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<style type="text/css">
<!--
body {
	background-image: url(Fon.jpg);
}
.style1 {
	color: #009900;
	font-weight: bold;
	font-style: italic;
}
-->
</style>
</head>
<body>
<h2 align="center" class="style1">Аффинные преобразования на плоскости</h2>
<p align="justify">В компьютерной графике все, что относится к двумерным преобразованиям, принято обозначать 2D (2-dimension). Среди множеств возможных преобразований ограничимся рассмотрением аффинного преобразования плоскости. </p>
<p align="justify">Аффинное преобразование является самым общим взаимно однозначным отображением плоскости на плоскость, при котором сохраняются: </p>
<ul>
  <li>
    <div align="justify"> прямые линии; </div>
  </li>
  <li>
    <div align="justify"> отношение длин отрезков, лежащих на одной прямой или на параллельных прямых; </div>
  </li>
  <li>
    <div align="justify"> отношение площадей фигур. </div>
  </li>
</ul>
<p align="justify">При этом параллельные прямые переходят в параллельные. </p>
<p align="justify">Аффинные преобразования подробно рассматриваются в аналитической геометрии. <em></em></p>
<p align="justify">Если на плоскости введена прямолинейная система координат, то точке <strong><em>P </em></strong> соответствует упорядоченная пара чисел (<strong><em>x, y</em></strong>) ее координат. Вводя на плоскости еще одну прямолинейную систему координат, мы ставим в соответствие той же точке <strong><em>P </em></strong> другую пару чисел (<strong><em>x', y'</em></strong>), определяющую точку <strong><em>P' </em></strong>. В матричной форме координаты точки можно задать в виде матрицы строки: <em><strong>P = [ x y ], P ' = [x ' y ']</strong></em>. </p>
<p align="justify">Переход от одной прямолинейной координатной системы к другой описывается следующими соотношениями: </p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x' = a*x + b*y + e; </em></strong></div></td>
    <td rowspan="2"><div align="center">, (12) </div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y' = c*x + d*y + f</em></strong></div></td>
  </tr>
</table>
<p align="justify">где <strong><em>a, b, </em></strong><strong><em>c </em></strong><strong><em>, </em></strong><strong><em>e </em></strong><strong><em>, </em></strong><strong><em>f </em></strong> - произвольные числа, связанные неравенством (13). </p>
<p align="center"><img src="im4%20(1).gif" width="73" height="42" align="absmiddle">. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(13) </p>
<p align="justify">Формулы (12) можно рассматривать двояко: либо сохраняется точка и изменяется координатная система, либо изменяется точка и сохраняется координатная система. <em>В первом </em> случае произвольная точка остается той же, изменяются лишь ее координаты (<strong><em>x, y</em></strong>) на (<strong><em>x', y'</em></strong>). <em>Во втором </em> случае формулы (12) задают отображение, переводящее произвольную точку <strong><em>P(x,y) </em></strong> в точку <strong><em>P'(x',y') </em></strong>, координаты которой определены в той же координатной системе. </p>
<p align="justify">Формулы (12) могут рассматриваться как правила, согласно которым в заданной системе прямолинейных координат преобразуются точки плоскости. </p>
<p align="justify">В аффинных преобразованиях плоскости особую роль играют несколько важных частных случаев, имеющих хорошо прослеживаемые геометрические характеристики. К ним относятся <strong>поворот (вращение) </strong> вокруг заданной точки, <strong>масштабирование (сжатие или растяжение), отражение относительно прямой </strong> (осевая симметрия - как частный случай масштабирования), <strong>перенос </strong>. </p>
<p align="justify">Поворот вокруг начала координат на угол <strong>&#966</strong>описывается формулами: </p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x' = x*</em></strong><strong><em>Cos </em></strong><strong>&#966</strong><strong><em> - y*</em></strong><strong><em>Sin </em></strong><strong>&#966</strong><strong><em>, </em></strong></div></td>
    <td rowspan="2"><div align="center"><em>. </em>(14) </div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y' = x*</em></strong><strong><em>Sin </em></strong><strong>&#966</strong><strong><em> + y*</em></strong><strong><em>Cos </em></strong><strong>&#966</strong></div></td>
  </tr>
</table>
<p align="justify">Положительными считаются углы, измеряемые против движения часовой стрелки от <strong><em>x </em></strong> к <strong><em>y </em></strong>. В случае отрицательных углов (по часовой стрелки) для модификации выражения (14) можно воспользоваться тождествами <strong>Cos </strong><strong>(-&#966</strong><strong>) = </strong><strong>Cos</strong><strong>&#966</strong> и <strong><em>Sin </em></strong><strong><em>(- </em></strong><strong>&#966</strong><strong><em>) = - </em></strong><strong><em>Sin </em></strong><strong>&#966</strong>. </p>
<p align="justify">В матричной форме преобразования (14) можно представить следующим образом: </p>
<p align="center"><strong></strong><img src="im4%20(2).gif" width="244" height="50" align="absmiddle">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(15) </p>
<p align="justify">Поворот вокруг точки с координатами ( <strong><em>x<sub>0</sub>, y<sub>0</sub></em></strong>) на угол <strong>&#966</strong> задается уравнениями: </p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x' = x<sub>0</sub> + (x - x<sub>0</sub> ) </em><em>* </em><em>Cos</em>&#966<em> - (y-y<sub>0</sub> ) * Sin</em>&#966</strong></div></td>
    <td rowspan="2"><div align="center">. (16) </div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y' = y<sub>0</sub> + (x - x<sub>0</sub> ) </em><em> * </em><em>Sin</em>&#966<em> + (y-y<sub>0</sub> ) * Cos</em>&#966</strong></div></td>
  </tr>
</table>
<p align="justify">Точки можно <em>промасштабировать </em> (сжать или растянуть) в <strong><em>S<sub>x</sub></em></strong> раз вдоль оси и в <strong><em>S<sub>y</sub></em></strong> раз вдоль оси , получив новые точки с координатами:</p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x' = x </em><em>* </em><em>S<sub>x</sub> ; </em></strong></div></td>
    <td rowspan="2"><div align="center">. (17) </div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y' = y </em><em>* </em><em>S<sub>y</sub></em></strong></div></td>
  </tr>
</table>
<p align="justify">Определяя матрицу </p>
<p align="justify"><img src="im4%20(3).gif" width="104" height="49" align="absmiddle">, можно записать в матричной форме </p>
<p align="center"><strong><em>[ </em></strong><strong><em>x</em></strong><strong><em>' </em></strong><strong><em>y</em></strong><strong><em>' ] = [ </em></strong><strong><em>x</em></strong><strong><em>y </em></strong><strong><em>] </em></strong><strong><em>S </em></strong>или <strong><em>P' = P </em><em>* </em><em>S </em></strong>. </p>
<p align="justify">Масштабирование производится относительно начала координат. Если <strong><em>Sx </em></strong><strong><em> = </em></strong><strong><em>Sy</em></strong>, то такое масштабирование называется <strong>однородным</strong>. Если <strong><em>Sx</em><img src="im4%20(0).gif" width="20" height="17" align="absmiddle"><em>Sy</em></strong>, то такое масштабирование называется <strong>неоднородным</strong>. </p>
<p align="justify">Если коэффициенты масштабирования больше 1, то выполняется <strong>растяжение</strong>. Если коэффициенты масштабирования больше 0, но меньше 1, то выполняется <strong>сжатие</strong>. </p>
<p align="justify"><strong>Отражение </strong> относительно оси абсцисс задается при помощи формул: </p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x </em></strong><strong><em>' = </em></strong><strong><em>x </em></strong><strong><em>; </em></strong></div></td>
    <td rowspan="2"><div align="center"><em>. </em>(18) </div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y </em></strong><strong><em>' = - </em></strong><strong><em>y</em></strong></div></td>
  </tr>
</table>
<p align="justify"><strong>Отражение </strong> относительно оси ординат задается при помощи формул: </p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x </em></strong><strong><em>' = - </em></strong><strong><em>x </em></strong><strong><em>; </em></strong></div></td>
    <td rowspan="2"><div align="center">. (19) </div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y </em></strong><strong><em>' = - </em></strong><strong><em>y</em></strong></div></td>
  </tr>
</table>
<p align="justify">Матрицы отражения похожи на матрицу масштабирования </p>
<p align="center"><img src="im4%20(5).gif" width="66" height="50">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="im4%20(6).gif" width="68" height="47">. </p>
<p align="justify">Точки на плоскости можно <strong>перенести </strong> в новые позиции путем добавления к координатам этих точек констант переноса. Для каждой точки <strong><em>P </em></strong><strong><em> (</em></strong><strong><em>x</em></strong><strong><em>, </em></strong><strong><em>y</em></strong><strong><em>) </em></strong>, которая перемещается в новую точку <strong><em>P </em></strong><strong><em> (</em></strong><strong><em>x</em></strong><strong><em>', </em></strong><strong><em>y</em></strong><strong><em>')</em></strong>, сдвигаясь на <strong><em>D<sub>x</sub></em></strong> единиц параллельно оси <strong><em>x </em></strong> и на <strong><em>D<sub>y</sub></em></strong> единиц параллельно оси <strong><em>y</em></strong>, можно написать уравнения: </p>
<p align="center"><strong><em>x' = x+D<sub>x</sub> ,&nbsp;&nbsp;&nbsp;&nbsp; y' = y + D<sub>y</sub></em></strong>.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (20) </p>
<p align="justify">Уравнение (20) можно записать в матричной форме: </p>
<p align="center">если <strong><em>T </em></strong><strong><em> = [ </em></strong><strong><em>D<sub>x</sub> </em></strong><strong><em></em></strong><strong><em>D<sub>y</sub></em></strong><strong><em>] </em></strong>, то <strong><em>[ </em></strong><strong><em>x </em></strong><strong><em>' </em></strong><strong><em>y </em></strong><strong><em>'] = [ </em></strong><strong><em>x </em></strong><strong><em></em></strong><strong><em>y </em></strong><strong><em>] + [ </em></strong><strong><em>Dx </em></strong><strong><em></em></strong><strong><em>Dy </em></strong><strong><em>] </em></strong>. </p>
<p align="justify">Итак <strong><em>2 </em></strong><strong><em>D </em></strong>-преобразования записываются в матричном виде следующим образом: </p>
<p align="center"><em><strong>P' = P + T, P' = P * S, P' = P  * R. </strong></em></p>
<p align="justify">Перенос реализуется отдельно с помощью сложения, а масштабирование и поворот с помощью умножения. Существует необходимость в том, чтобы объединить все три преобразования в одно. Это можно осуществит с помощью <strong>однородных координат </strong>. Однородные координаты были введены в геометрии и используются в компьютерной графике. </p>
<p align="justify">Однородными координатами точки <strong><em>P </em></strong><strong><em>(</em></strong><strong><em>x</em></strong><strong><em>, </em></strong><strong><em>y</em></strong><strong><em>) </em></strong> является представление координат в виде <strong><em>( W </em><em>* </em><em>x, W * y, W) </em></strong> для любого масштабного множителя <strong><em>W</em><img src="im4%20(0).gif" width="20" height="17" align="absmiddle"></strong><strong><em>0 </em></strong>. Если для точки задано ее представление в однородных координатах <strong><em>P </em></strong><strong><em>(</em></strong><strong><em>X</em></strong><strong><em>, </em></strong><strong><em>Y</em></strong><strong><em>, </em></strong><strong><em>W</em></strong><strong><em>) </em></strong>, то ее 2-х мерные декартовы координаты: <strong><em>x </em></strong><strong><em>= </em></strong><strong><em>X </em></strong><strong><em>/ </em></strong><strong><em>W</em></strong><strong><em>, </em></strong><strong><em>y </em></strong><strong><em> = </em></strong><strong><em>Y </em></strong><strong><em>/ </em></strong><strong><em>W</em></strong>. Как правило, <strong><em>W </em></strong><strong><em> = 1 </em></strong>, поэтому операция деления не требуется. Однородные координаты можно представить как отображение промасштабированной с коэффициентом <strong><em>W </em></strong> плоскости в плоскость <strong><em>z </em></strong><strong><em> = </em></strong><strong><em>W </em></strong><strong><em></em></strong>(при <strong><em>W </em></strong><strong><em> = 1 </em></strong>в плоскость <strong><em>z </em></strong><strong><em> = 1 </em></strong>). </p>
<p align="justify">В однородных координатах точки описываются 3-х элементными матрицами-строками, а матрицы преобразования будут иметь размер 3 &#215 3. Таким образом, <strong>перенос в однородных координатах </strong> представляется следующим образом </p>
<p align="center"><strong><em>[ </em></strong><strong><em>x </em></strong><strong><em>' </em></strong><strong><em>y </em></strong><strong><em>' </em></strong><strong><em>z </em></strong><strong><em>' 1] = [ </em></strong><strong><em>x </em></strong><strong><em></em></strong><strong><em>y </em></strong><strong><em></em></strong><strong><em>z </em></strong><strong><em> 1] </em></strong><strong><em>&#215 </em></strong><img src="im4%20(7).gif" width="106" height="82" align="absmiddle">. </p>
<p align="justify">Или <strong><em>P </em></strong><strong><em>' = </em></strong><strong><em>P </em></strong><strong><em>&#215 </em></strong><strong><em>T </em></strong><strong><em>[ </em></strong><strong><em>D<sub>x</sub></em></strong><strong><em>, </em></strong><strong><em>D<sub>y</sub> </em></strong><strong><em>] </em></strong>, где </p>
<p align="center"><strong><em>T </em></strong><strong><em>[ </em></strong><strong><em>D<sub>x</sub></em></strong><strong><em>, </em></strong><strong><em>D<sub>y</sub> </em></strong><strong><em>] = </em></strong><img src="im4%20(7).gif" width="105" height="80" align="absmiddle">.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (21) </p>
<p align="justify">Последовательные переносы аддитивны. </p>
<p align="justify"><strong>Масштабирование в однородных координатах </strong> записывается в следующем виде: </p>
<p align="center"><strong><em>[x' y' z' 1] = [x y z 1] </em></strong><strong>&#215 </strong><img src="im4%20(9).gif" width="92" height="76" align="absmiddle">. </p>
<p align="justify">Или <strong><em>P' = P </em></strong><strong>&#215 </strong><strong><em>S [S<sub>x</sub> , S<sub>y</sub> ] </em></strong>, где </p>
<p align="center"><strong><em>S </em><em>[ S<sub>x</sub> , S<sub>y </sub>] = </em></strong><img src="im4%20(9).gif" width="93" height="75" align="absmiddle">.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (22) </p>
<p align="justify">Последовательные масштабирования являются мультипликативными. </p>
<p align="justify"><strong>Поворот в однородных координатах </strong> записывается в следующем виде: </p>
<p align="center"><strong><em>[ </em></strong><strong><em>x</em></strong><strong><em>' </em></strong><strong><em>y</em></strong><strong><em>' </em></strong><strong><em>z</em></strong><strong><em>' 1] = [ </em></strong><strong><em>x </em></strong><strong><em></em></strong><strong><em>y </em></strong><strong><em></em></strong><strong><em>z </em></strong><strong><em> 1] </em></strong><strong>&#215 <img src="im4%20(10).gif" width="147" height="76" align="absmiddle"></strong>. </p>
<p align="justify">Или <strong><em>P ' = P </em><em> &#215 </em><em>R [</em>&#966<em>] </em></strong>, где </p>
<p align="center"><strong><em>R </em></strong><strong><em>[</em>&#966</strong><strong><em>] = </em></strong><strong><img src="im4%20(10).gif" width="148" height="75" align="absmiddle"></strong>. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(23) </p>
<p align="justify">Последовательные повороты являются аддитивными. В матрице, задающей поворот, каждый из двух столбцов подматрицы размером 2<strong><em>&#215</em></strong>2, содержащей синусы и косинусы, как векторы обладают следующими свойствами: </p>
<ul>
  <li>
    <div align="justify"> Каждый вектор является единичным. </div>
  </li>
  <li>
    <div align="justify"> Они взаимно ортогональны (их скалярное произведение равно нулю). </div>
  </li>
  <li>
    <div align="justify"> Направления, задаваемые векторами при их повороте на <strong><em>R </em></strong><strong><em>[</em>&#966</strong><strong><em>] </em></strong>, совпадают с осями <strong><em>x </em></strong> и <strong><em>y </em></strong>. </div>
  </li>
</ul>
<p align="justify">Первые два свойства справедливы также и для строк подматрицы размером 2<strong><em>&#215</em></strong>2. </p>
<p align="justify">Общая матрица <strong><em>2</em></strong><strong><em>D </em></strong>-преобразований имеет вид </p>
<p align="center"><strong><em>M </em></strong><strong><em> = </em></strong><img src="im4%20(11).gif" width="95" height="81" align="absmiddle">. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(24) </p>
<p align="justify">Левая верхняя часть матрицы размером 2<strong><em>&#215</em></strong>2 задает поворот и масштабирование, часть последней строки размером 1<strong><em>&#215</em></strong>2 задает перенос. </p>
<p align="justify"><strong>Композицией </strong> (или <strong>объединением, конкатенацией</strong>) аффинных преобразований называется результирующее аффинное преобразование, получаемое в результате произведения матриц поворота, переноса, масштабирования. </p>
<p align="justify">Композиция матриц применяется для объединения отдельных преобразований потому, что к точке более эффективно применять одно результирующее преобразование, чем последовательность преобразований друг за другом. Так например, матрицу поворота вокруг произвольной <strong><em>O<sub>1</sub> </em></strong> точки можно получить, выполняя композицию матриц для трех элементарных преобразований: </p>
<ul>
  <li>
    <div align="justify"> Переноса, при котором точка <strong><em>O<sub>1</sub></em></strong> перемещается в начало координат;</div>
  </li>
  <li>
    <div align="justify"> Поворот; </div>
  </li>
  <li>
    <div align="justify"> Перенос, при котором точка из начала координат возвращается в первоначальное положение <strong><em>O<sub>1</sub></em></strong>. </div>
  </li>
</ul>
<p align="justify">В общем случае умножение матриц некоммутативно. Однако в частных случаях коммутативность имеет место. </p>
<p align="justify">В следующих случаях композиции аффинных преобразований коммутативность имеет место: </p>
<ul>
  <li> Перенос - перенос; </li>
  <li> Масштабирование - масштабирование; </li>
  <li> Поворот - поворот; </li>
  <li> Однородное масштабирование - поворот. </li>
</ul>
<p align="justify">Для преобразования плоских фигур необходимо выполнить преобразования одной или нескольких точек привязки фигуры к плоскости и, возможно, параметров фигуры (при масштабировании). После чего надо построить фигуру по ее новым параметрам. </p>
<p align="justify">Например, для преобразования окружности или эллипса выполняется преобразование их центров, а в случае масштабирования и преобразование радиусов. </p>
<p align="justify">Для многоугольников задается матрица фигуры <strong><em>V</em></strong>, <strong><em>i </em></strong><strong><em>- </em></strong>ая строка которой соответствует однородным координатам <strong><em>i </em></strong><strong><em>- </em></strong>ой вершины многоугольника. Преобразование выполняется умножением матрицы фигуры на общую матрицу преобразования. Т. е. <strong><em>V </em></strong><strong><em>' = </em></strong><strong><em>V </em></strong><strong>&#215 </strong><strong><em>M </em></strong>. </p>
<p align="justify">Для вычисления нового положения точки как произведения ее однородных координат <strong><em>[</em></strong><strong><em>x </em></strong><strong><em></em></strong><strong><em>y </em></strong><strong><em> 1] </em></strong> на матрицу общего преобразования <strong><em>M </em></strong> (24) требуется 9 операций умножения и 6 операций сложения. </p>
<p align="justify">Если производить вычисления на основе системы уравнений (12), то необходимо 4 операции сложения и 4 операции умножения. Таким образом, в этом случае время выполнения преобразований графической программой ниже. Это может быть существенным, если учесть, что часто преобразованиям подвергаются большое количество точек, и поэтому проблема эффективности программной реализации преобразований актуальны. </p>
<p align="justify">Для выполнения поворота необходимы 4 операции умножения и две операции сложения. Для повышения быстродействия программы преобразования при повороте на малые углы можно считать, что <strong><em>Cos</em>&#966<em>=</em><em> 1 </em></strong>. При этом уравнения поворота (14) принимают вид: </p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x </em></strong><strong><em>' = </em></strong><strong><em>x </em></strong><strong><em> - </em></strong><strong><em>y </em></strong><strong>&#215 </strong><strong><em>Sin</em>&#966</strong><strong><em>, </em></strong></div></td>
    <td rowspan="2"><div align="center"><em>. </em>(25) </div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y ' = x </em><em> &#215 </em><em>Sin</em>&#966<em> + y </em></strong></div></td>
  </tr>
</table>
<p align="justify">Более точная аппроксимация может быть достигнута, если вместо <strong><em>x </em></strong> во второе уравнение подставить <strong><em>x</em></strong><strong><em>' </em></strong>: </p>
<table width="70%"  border="0" align="center">
  <tr>
    <td><div align="center"><strong><em>x' = x - y </em></strong><strong>&#215 </strong><strong><em>Sin</em>&#966</strong><strong><em>, </em></strong></div></td>
    <td rowspan="2"><div align="center"><em>. </em>(26)</div></td>
  </tr>
  <tr>
    <td><div align="center"><strong><em>y' = x' </em><em> &#215 </em><em>Sin</em>&#966<em> + y </em></strong></div></td>
  </tr>
</table>
<p align="justify">Однако необходимо помнить, что при использовании аппроксимации возможны неточности при преобразованиях и, как следствие, вывод неверного изображения.</p>

</body>
</html>
