<html>
<head>
<title>Дисковая память</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" href="../images/styles.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<h1 align="center"> Дисковые внешние запоминающие устройства</h1>
<p>Магнитные диски - это запоминаюшие устройства, основу которых составляет вращающаяся 
  пластина с намагничиваемой поверхностью, на которой сохраняется цифровая информация. 
  Для считывания и записи данных в дисководе диска имеются головки считывания-записи. 
  Диски называются также устройствами с произвольным доступом, поскольку головка 
  считывания-записи может быть независимо позиционированна в любое место на диске. 
</p>
<p>Существует два основных вида дисков: гибкий диск (дискета) и жесткий диск.Дискета 
  - это диск, который можно удалить из дисковода. Жесткий диск - несъемный, он 
  фиксирован на дисководе. </p>
<p>Дискеты изготавливаются из гибких материалов и чаще всего бывают 3.5, 5.25 
  и 7 дюймов в диаметре. Информация может записываться на одну или обе стороны. 
  В большинстве случаев у дискет используются обе стороны. Жесткие диски состоят 
  из одной или нескольких пластин, смонтированых на оси, вращаемой небольшим мотором. 
  Для хранения информации каждая пластина покрыта с обеих сторон намагничиваемым 
  материалом. У каждой стороны пластины имеется своя головка считывания-записи. 
  Головки считывания-записи смонтированы на позиционерах, перемещаемых вместе 
  и управляемых с помощью другого мотора. Контроллер диска, соединенный с каждим 
  дисководом проводами, представляет собой плату, которая с помощью электрических 
  сигналов управляет диском и головками считывания-записи. Плата контроллера диска 
  вставляется в разъем на системной плате компьютера и подсоединяется к главной 
  магистрали, по которой ей передаеются сигналы от центрального процессора. Контроллер 
  управляет обменом данных с диском и позиционированием головок считывания-записи. 
</p>
<h3 align="center">Физическая организация данных на диске </h3>
<p> Дисковые дорожки Каждая поверхность диска делится на дорожки , на которые 
  записы вается информация. Перед выполнением операции чтения или записи предназначенная 
  для данного диска головка считывания-записи перемещается к одной из его дорожек. 
  На большинстве гибких дисков размером 5.25 дюйма имеется 40 или 80 дорожек. 
  Такие диски называются дисками с высокой плотностью (high density). </p>
<p>На жестких дисках количество дорожек во много раз больше, чем на гибких , поскольку 
  они имеют твердую поверхность и могут управляться с большей точностью. Если 
  диск состоит из двух и более пластин (пластиной называется вращающаяся поверхность), 
  то для обозначения всех дорожек с одинаковыми номерами используется термин "цилиндр". 
  Дорожки на диске нумеруются с 0 до максимального номера для данного диска. Так 
  же нумеруются и записывающие поверхности пластин диска.</p>
<p> Часто требуется узнать, какую емкость имеет данный диск . Для расчета можно 
  воспользоваться несколькими его характеристиками. </p>
<p>Во-первых , необходимо знать объем данных, которые можно записать на одной 
  дорожке, выражаемый обычно в байтах. Затем необходимо знать число дорожек на 
  одной стороне диска. Полное число дорожек можно определить , умножив плотность 
  дорожек (обычно выражаемую в количестве дорожек на жюйм и обозначаемую tpi, 
  от tracks per inch), на длину рабочей части поверхности, на которой расположены 
  дорожки. Наконец , необходимо знать число используемых для хранения информации 
  поверхностей, которое обычно равно 1 для односторонних и 2 для двусторонних 
  дисков.В случае жесткого диска это число обычно в два раза больше количества 
  пластин. Для вычисления полной емкости диска может быть использована следующая 
  формула:</p>
<p> <b>емкость диска = объем информации на одной дорожке* число дорожек на одной 
  поверхности * число поверхностей.</b></p>
<p> Объем доступного для использования дискового пространства будет на самом деле 
  меньше, из-за накладных расходов, связанные с размещением на диске специальной 
  информации, необходимой при работе с диском. Эта дополнительная информация, 
  записываемая на каждую дорожку, используется в контроллере диска для нахождения 
  требуемой дорожки. </p>
<p> Дорожки , имеющие форму окружности, подразделяются на секторы, которые являются 
  основной единицей хранения информации на дисках. Использование секторов дает 
  возможность пользоваться общим методом хранения данных на дисках различных объемов. 
  Каждый раз , когда требуется передать данные от диска микропроцессору, головка 
  считывания-записи устанавливается на определенную дорожку. После того как дорожка 
  вращается под головкой, контроллер диска осуществляет поиск нужного сектора, 
  сканируя проходящие под головкой секторы. Когда нужный сектор найден, контроллер 
  диска считывает из него данные и возвращает их. Число секторов на дорожке может 
  быть разным и зависит от объема сохраняемых на ней данных. Для дискет допускается 
  8, 9, 15 секторов на дорожку. </p>
<p>Сектор является минимальной адресуемой единицей при обращениях к внешней памяти. 
  Адрес сектора на внешней памяти состоит из трех составляющих: </p>
<li>номер дорожки (нумерация дорожек начинается с 0); </li><br>
 <li> номер головки (нумерация головок начинается с 0); </li><br>
  <li>номер сектора на дорожке (нумерация секторов начинается с 1).</li><br>
<p> Этот метод нумерации используется в процедурах BIOS, осуществляющих форматирование, 
  чтение и запись секторов. </p>
<p>Как уже говорилось, объем сохраняемых в каждом секторе данных зависит от емкости 
  дорожки и числа входящих в нее секторов (предполагается, что плотность всех 
  дорожек постоянна). Поскольку емкость дорожки фиксирована, размер сектора можно 
  изменять, меняя число секторов на дорожке. Обычно размер сектора фиксирован 
  и число секторов на дорожке вычисляется делением емкости дорожки на размер сектора( 
  плюс объем накладных расходов). В процессе форматирования часть дискового пространства 
  теряется при разбиении дорожки на секторы, а также в результате записи на диск 
  специальной информации, используемой для нахождения секторов. Таким образом, 
  объем доступного для использования дискового пространства сокращается. </p>
<p>В DOS используется сквозная нумерация секторов (линейная адресация ). Для получения 
  абсолютного номера сектора надо к вычисленному значению прибавить еще некоторую 
  величину s0 - абсолютный номер сектора начала логического диска.<br>
  Как мы увидим ниже, величины ns, nh, s0 могут быть получены из системной информации, 
  находящейся на самом носителе.</p>
<p>Нумерация секторов внутри логического диска начинается с 0, и номер логического 
  сектора может быть вычислен как:</p>
<p align="center"><b>logs = ( (t * ns) + h) * nh + s-1; где</b></p>
<p>t, h, s - физический адрес (дорожка, головка, сектор); <br>
  ns - количество секторов на дорожке, <br>
  nh - количество головок чтения/записи.</p>
<p>На физическом уровне можно управлять работой дисков с помощью прерывания 13h 
  BIOS. Изучить проблемы управления дисковой памятью можно по <a href="../library/v01b/ch1.htm" target=_blank>книге</a> 
  [10] </p>
<h3 align="center">Логическая организация дисков. </h3>
<p>DOS поддерживает диски разных типов. Это стало возможным благодаря тому , что 
  информация, необходимая для работы с диском (например, его объем), сохраняется 
  на самом диске в специальной, определенной DOS, области. Для управления файлами 
  и дисковым пространством на каждом диске должна храниться дополнительная информация, 
  например объем использованного пространства и имена сохраняемых файлов. Эта 
  информация невидима для пользователя, но обязательно имеется на каждом диске. 
  Информация размещается на диске в определенной последовательности, поэтому все 
  диски DOS имеют сходную структуру. Это позволяет DOS получать информацию о типе 
  диска, о способе выделения дискового пространства, а также о размещенных на 
  нем файлах. Диск включает четыре области.</p>
<p align="center"><img src="images/disk_1.gif" width="500" height="600"> </p>
<p align="center">Рис.1. Логическая организация диска</p>
<p align="left">Так для дискет используется следующее размещение информации: лог. 
  сектор 0 - BOOT запись, с1 по9 -1 FAT, с10 по18 - 2 FAT,<br>
  с19 по32 - Область корневого каталога, с 33 по 2879 - Область данных.</p>
<p></p>
<p>Первая, зарезервированная область часто называется загрузочной записью(MBR 
  - Master Boot Record) . Вторая область включает таблицу размещения файлов FAT(File 
  Allocation Table), описывающую, как используется дисковое пространство. Далее 
  следует каталог файлов (Root Directiry), в котором хранится информация о длине, 
  расположении, дате и времени создания каждого дискового файла . . Последней 
  является область данных, в которой хранятся пользовательские файлы. Область 
  начальной загрузки, FAT и кластеры. Область начальной загрузки, или резервируемая 
  область, представляет первую секцию диска. Поскольку диски могут иметь разное 
  число рабочих сторон, дорожек и секторов, DOS должна определять эти характеристики 
  при первом обращении к диску. Описывающая диск информация всегда должна храниться 
  в строго установленном физическом участке диска. Обычно это первый сектор диска- 
  дорожка 0, поверхность 0, сектор 1.</p>
<p>Область начальной загрузки, как правило, занимает один сектор, но может быть 
  и больше. По этой причине ее чаще называют областью резервируемых секторов.На 
  рисунке показаны четыре составляющие области начальной загрузки: </p>
<li>код команды безусловного перехода jmp,</li> <br>
<li> идентификатор изготовителя, </li> <br>
<li> блок параметров BIOS </li> <br>
<li>программа начальной загрузки.</li> <br>
<p> В первых байтах области начальной загрузки хранится код команды jmp. Если 
  диск является системным диском DOS, в процессе операции начальной загрузки данные 
  считываются в память компьютера, после чего выполняется команда jmp, которая 
  обеспечивает переход к программе начальной, минуя идентификатор изготовителя 
  и блок параметров BIOS. Вторая часть области начальной загрузки представляет 
  8-байтовое поле, содержащее идентификатор изготовителя. DOS не использует это 
  поле. Обычно в это поле заносится название фирмы-изготовителя и версия DOS Третьей 
  частью области начальной загрузки является блок параметров BIOS. Это таблица 
  специальных параметров диска, используемых DOS при определении его емкости, 
  а также относительного расположения FAT и файлового каталога. Блок параметров 
  BIOS(ВРВ) имеется на каждом диске. Содержимое ВРВ описывается ниже. </p>
<p>Четвертая часть области начальной загрузки называется программой начальной 
  загрузки, поскольку в ней содержится программа, запускающая компьютер. Загрузочная 
  программа выполняет работу по запуску системы, связанную с загрузкой DOS в память. 
  Эта программа имеется в области начальной загрузки на всех дисках, независимо 
  от того , содержатся ли на диске системные файлы DOS, но используется только 
  в том случае, если диск системный. Системный диск можно создать с помощью программы 
  FORMAT, поставляемой с MS-DOS. В случае, если команда FORMAT используется со 
  специальным ключем(обычно/S), на диск копируются два дополнительных файла(чаще 
  всего IO.SYS и MSDOS.SYS), содержащие программы операционной системы MS-DOS. 
  Эти файлы скрыты от пользователя и не появляются в листинге дискового каталога. 
  Однако программа начальной загрузки "знает" об их присутствии и загружает их 
  в память во время загрузки системы. </p>
<p>Диск, с которого загружается операционная система, называется системным. При 
  форматировании с помощью программы DOS FORMAT все четыре секции области начальной 
  загрузки записываются в зарезервированную на диске область, которая всегда начинается 
  с первого сектора. </p>
<p>С точки зрения распредения дискового пространства диск разбит на кластеры. 
  <b>Кластер</b> представляет собой группу последовательно расположенных секторов. 
  Кластеры - еденицы хранения файлов. Если DOS получает запрос на выделение дискового 
  пространства, она выделяет сразу целый кластер. Информация об используемых данным 
  файлом секторах сохраняется в таблице размещения файлов. Эта таблица имеется 
  на всех дисках DOS. Использование кластеров позволяет сэкономить выделяемое 
  для таблицы размещения файлов дисковое пространство. Кластеры обеспечивают более 
  высокий уровень организации диска и облегчают обращение.. Размер кластера является 
  компромиссом между двумя противоречивыми требованиями: с точки зрения экономии 
  дискового пространства выгоден малый размер кластера, так как для маленького 
  файла (размером даже в один байт) выделяется целый кластер, большая часть которого 
  не используется.Но с другой стороны, при малом размере кластера их на диске 
  получится очень много, и управление ими усложняется. FAT представляет собой 
  &quot;карту&quot; дискового пространства - массив элементов, каждый из которых 
  соответствует одному кластеру диска. Номер элемента соответствует номеру кластера.<br>
  Поскольку область диска, содержащая системную информацию, распределена предварительно, 
  она в FAT не отражается. Первые два элемента FAT не используются (первый байт 
  содержит код, совпадающий с полем Media Boot-сектора), нумерация кластеров области 
  данных диска начинается с 2. </p>
<p>Размер элемента FAT может быть 12 или 16 бит (см. поле SysCode в элементе раздела 
  жесткого диска, а также поле FatForm в Boot -секторе). Описание содержимого 
  полей далее дается для 12-битного формата FAT, в скобках указываются значения 
  для 16-битного формата. Значения элементов FAT от 2 до 0FEFH (0FFEFH) включительно 
  - информационные значения. Такое значение - номер следующего кластера, распределенного 
  данному файлу. Таким образом, FAT обеспечивает списковую структуру распределения 
  - каждый ее элемент содержит указание на следующий элемент. Поскольку кластеры 
  распределяются файлу по мере его заполнения, файл не обязательно занимает смежные 
  кластеры, FAT может обеспечить связывание в цепочку разнесенных по диску кластеров. 
  Другие значения элементов зарезервированы для системной информации. Значение 
  0 индицирует свободный кластер. Значения элементов от 0FF0Н до 0FF6H (от 0FFF0H 
  до 0FFF6H) - резервные кластеры. Значение 0FF7H (0FFF7H) - сбойный кластер. 
  Значения от 0FF8H до 0FFFH (от 0FFF8H до 0FFFFH) - признак конца цепочки, последнего 
  кластера файла.</p>
<p>Как уже упоминалось, на диске хранятся две идентичные копии FAT, расположенные 
  одна за другой. Следом за FAT размещается Корневой Каталог, который Каталог 
  состоит из Элементов Каталога. Формат записи корневого каталога</p>
<div align="center">
  <table width="502" border="1" cellpadding="1" cellspacing="1">
    <tr> 
      <td> 
        <p><b>ИМЯ ФАЙЛА:</b> Это поле имеет длину восемь байт, <br>
          расположенных в элементе справочника со смещениями от 0 до 7 <br>
          и содержит имя файла. Если длина имени меньше восьми <br>
          символов, то недостающие символы заменяются пробелами. <br>
          <b>РАСШИРЕНИE: </b>Это поле имеет длину три байта, которые <br>
          расположены со смещениями от 8 до 10 от начала элемента <br>
          справочника. <br>
          <b>АТРИБУТ:</b> Это поле состоит из одного байта, <br>
          расположенного со смещением 11 от начала элемента <br>
          справочника. Поле атрибута используется для установления <br>
          признака &quot;скрытого&quot; файла, т.е. такого файла, имя которого 
          не <br>
          обнаруживается обычными программами работы со справочниками. <br>
          Два бита этого байта служат для индикации атрибутов <br>
          &quot;скрытого&quot; и &quot;системного&quot; файла.. <br>
          <b>ЗАРЕЗЕРВИРОВАННОЕ ПОЛЕ:</b> Это поле зарезервировано для <br>
          возможного использования в будущем. В первой версии ДОС это <br>
          поле имело длину 12 байт, но в дальнейшем его сократили до 10 <br>
          байт, расположенных со смещениями от 12 до 21 относительно <br>
          начала элемента справочника. <br>
          <b>ВРЕМЯ:</b> Это поле имеет длину два байта в формате <br>
          16-разрядного целого числа без знака, расположенные со <br>
          смещениями 22 и 23 относительно начала элемента. Начиная с <br>
          версии ДОС 1.10 в этом поле хранится время создания или <br>
          модификации файла. <br>
          Код времени, хранящийся как 16-разрядное целое число без <br>
          знака, вычисляется по следующей формуле: <br>
          время = часы * 2048 + минуты * 32 + секунды / 2<br>
          <b>ДАТА : </b>Это поле состоит из двух байт, хранящихся со <br>
          смещениями 24 и 25 от начала элемента. Как и время, даты <br>
          хранятся в виде целого 16-разрядного числа без знака, которое <br>
          вычисляется по формуле: <br>
          Дата = (год - 1980) * 512 + Месяц * 32 + День<br>
          <b>НОМЕР НАЧАЛЬНОГО КЛАСТЕРА : </b>Это двухбайтовое поле, <br>
          расположенное со смещением 26, 27 от начала элемента, <br>
          содержит 16-разрядное число, являющееся смещением до <br>
          начальной точки файла в FAT таблице . Начальный кластер<br>
          является первой частью пространства данных на дискете. <br>
          <b>РАЗМЕР ФАЙЛА :</b> Это поле состоит из четырех байтов, <br>
          размещенных со смещениями от 28 до 31 от начала элемента. </p>
      </td>
    </tr>
  </table>
</div>
<p>Изучить проблемы управления дисковой памятью на логическом уровне можно по 
  книгам <a href="../library/v01b/ch2.htm" target=_blank> [10],</a> и [<a href="../library/jourdain/510.htm"target=_blank>7</a>]</p>
<hr class=forhr align="center">
<div align="center">
  <table width="600">
    <tr> 
      <td> 
        <p align="center">&nbsp;</p>
      </td>
      <td> 
        <p align="center"><b> <a href="perif.htm">в начало раздела</a></b></p>
      </td>
      <td> 
        <p align="center">&nbsp;</p>
      </td>
    </tr>
  </table>
</div>
<h1>&nbsp;</h1  >
<p><strong></strong> <strong><font color="#0000FF"></font></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</body>
</html>
