<html>
<head>
<title>Таймер, звук, время </title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" href="../images/styles.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<h1 align="center">Таймер, звук, время </h1>

<p> Последовательность импульсов частоты 1193180 гц. поступает на три канала микросхемы 
  таймера. В каждом канале есть свой счетчик, работающий как делитель частоты, 
  максимальное число которое может быть записано в счетчике (коэффициент деления) 
  - 655357. Счетчики каналов таймера независимы друг от друга и доступны для программиста. 
  Назначение каналов таймера следующее: </p>
<p>канал 0 используется для системной службы времени. При инициализации системы 
  BIOS записывает в счетчик этого канала максимально возможное число, таким образом, 
  импульсы на выходе делителя выдаются с частотой около 18.2 гц (период этой частоты 
  - около 55 мсек - программисты иногда называют &quot;тиком&quot; таймера). Выход 
  делителя этого канала поступает на контроллер прерываний и вызывает прерывание 
  с номером 8; <br>
  выход канала 1 используется схемами регенерации памяти, поэтому программисты 
  с этим каналом не работают; <br>
  выход канала 2 поступает на динамик ПЭВМ, этот канал используется для генерации 
  звука. <br>
  Каждый канал может работать в одном из 6 режимов, но программисты, как правило, 
  используют его в режиме 3 (генератор меандра).</p>
<p>Программирование канала таймера представляет собой запись числа в счетчик канала. 
  Имеется один управляющий порт - 043h для всех каналов и по одному порту данных 
  для каждого канала - 040h, 041h, 042h. При программировании следует записать 
  в порт 043h управляющий байт, который обычно имеет вид: x x 1 1 0 1 1 0b,где 
  xx - номер канала таймера, а затем послать в порт данных выбранного канала сначала 
  младший, а затем старший байт счетчика.</p>
<p>Если динамик ПЭВМ включен и управляется от таймера, то высота генерируемого 
  звука определяется частотой импульсов канала 2 и зависит от коэффициента деления, 
  записанного в счетчике канала. Включение-выключение динамика управляется двумя 
  разрядами в однобайтном регистре контроллера программируемого периферийного 
  интерфейса, доступ к которому - через порт 061h. Следует иметь в виду, что этот 
  регистр используется также и для других целей, так что при его программировании 
  следует вначале прочитать его содержимое, изменить требуемые разряды, а затем 
  записать в порт 061h новое значение. Для управления динамиком используются такие 
  разряды регистра: 0 - единица в этом разряде устанавливает управление динамиком 
  от таймера <br>
  1 - включение/выключение (1/0) динамика. <br>
  Из приведенной выше методики программирования таймера очевидно, что динамик 
  может воспроизводить только чистые (однотонные) звуки. Для создания полифонического 
  звучания программа должна быстро переключать (перепрограммировать) таймер с 
  одного тона на другой. Это достаточно громоздкая операция, которая занимает 
  к тому же весь ресурс времени центрального процессора, поэтому мы здесь ограничимся 
  только чистыми звуками.<br>
  Для нот первой октавы (включая полутона) ряд коэффициентов деления следующий:<br>
  912 - 861 - 813 - 767 - 724 - 678 - 645 - 609 - 574 - 542 - 512 - 483<br>
  Для перехода на октаву ниже следует умножить члены этого ряда на 2, на октаву 
  выше - на 0,5.</p>
<h3 align="center"> Cлужба времени </h3>
<p>Импульсы, поступающие с выхода канала 0 таймера, вызывают прерывание 8. Обработчик 
  этого прерывания в BIOS подсчитывает количество таких импульсов в 4-байтной 
  области памяти (два 2- байтных слова). Этот счетчик, находящийся в области памяти 
  BIOS по адресу 0040:006C, таким образом, хранит количество тиков таймера, прошедших 
  от полуночи (0 в счетчике соответствует полночи). При запуске системы BIOS запрашивает 
  у оператора время дня, переводит его в количество тиков и записывает по указанному 
  адресу. Затем в процессе работы это число модифицируется обработчиком прерывания 
  8. То обстоятельство, что обработчик прерывания 8 в BIOS обеспечивает работу 
  службы времени следует учитывать при перехвате прерывания 8 и при перепрограммировании 
  канала 0 таймера.</p>
<p>Доступ к счетчику времени поддерживается прерыванием 01Ah. При обращении к 
  этому прерыванию со значением 0 в регистре AH мы получаем в CX старшую, а в 
  DX - младшую части счетчика. При обращении со значением 1 в AH мы задаем счетчик 
  в регистрах CX, DX, и это значение записывается в память BIOS.</p>
<p>В современных ПЭВМ имеются независимые часы реального времени, показания которых 
  содержатся в CMOS-памяти. Регистры CMOS-памяти, связанные с временем и датой 
  следующие: 0 - секунды, 2 - минуты, 4 - часы, 6 - день недели (0 - воскресенье), 
  7 - день месяца, 8 - месяц, 9 - год. Доступ к этим данным - либо через порты 
  070, 071h, либо через прерывание 01A.h Функция 2 этого прерывания (AH=2) - чтение 
  часов реального времени, функция 3 - установка часов, функции 4, 5 - чтение 
  и установка даты соответственно.</p>
<p>Технология управления таймером и часами, формирования звуковых сигналов .подробно 
  описаны в [<a href="../library/frolov/278-9.html" target=_blank>6</a>],[<a href="../library/jourdain/210.htm"target=_blank>7</a>].</p>
<hr class=forhr align="center">
<div align="center"> 
  <table width="600">
    <tr> 
      <td> 
        <p align="center">&nbsp;</p>
      </td>
      <td> 
        <p align="center"><b> <a href="perif.htm">в начало раздела</a></b></p>
      </td>
      <td> 
        <p align="center">&nbsp;</p>
      </td>
    </tr>
  </table>
</div>
<h1>&nbsp;</h1  >
<p><strong></strong> <strong><font color="#0000FF"></font></strong></p>
<p><br>
  Сигнал тревоги может быть задан при помощи функции 6 прерывания 0x1A, а отменен 
  - функцией 7, как это показано в следующем примере.</p>
<p></p>
</body>
</html>
