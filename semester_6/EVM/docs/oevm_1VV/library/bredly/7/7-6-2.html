<html><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">



<body background="../images/bgrwhite.gif"><head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
 <TITLE>Дэвид Дж. Брэдли</TITLE>
</head>



<h2>7.6. Модель программирования 8087</h2>

<h3>7.6.2. Управляющее слово</h3>

<p>Сопроцессор 8087 содержит два управляющих регистра. Один регистр нужен для записи управляющего слова, другой - для считывания слова состояния. Управляющий регистр позволяет программисту задать режим рабоиы микросхемы 8087, далее о возможностях некоторых из них будет лишь упомянуто; рассмотрение всех возможных вариаций управляющего слова выходит за пределя этой книги. Структура управляющего регистра показана на Фиг. 7.7. Управляющее слово позволяет выбрать один из двух различных типов бесконечности. По умолчанию способом замыкания числовой системы является проективное замыкание, при котором сопроцессор 8087 трактует положительную, и
отрицательную бесконечности как  единую бесконечность без знака. Другой способ - аффинное замыкание, в которое входят и положительная, и отрицательная бесконечности. Хотя может показаться, что проективное замыкание теряет информацию, оно никогда не приводит к бессмысленным результатам. Аффинное замыкание в программе необходимо использовать только тогда, когда неоюходима дополнительная информация и когда программа написана для того, чтобы иметь дело с (возможно) неверными результатами.
<p>
Сопроцессор 8087 позволяет выбрать один из четырех способов округления чисел. Округление возникает тогда, когда результат требует большей точности, чем позволяет представление чисел. Метод округления определяет, какое число выбирается в качестве результата. Методы округления включают: выбор следующего большего числа в системе представления чисел, следующего меньшего числа, округление в направлении нуля, и округление в направлении четного числа.  Сопроцессор 8087 также дает возможность программе не использовать полностью 64-битовую точность временного действительного формата ИИЭР. Эта возможность не уменьшает время выполнения команд и не должна выполняться только для того, чтобы сделать команды процессора 8087 совместимыми с некоторыми существовавшими ранее процедурами обработки.
<p>
<table align="center">
  <tr>
    <th colspan="3" class="high">Маски исключения (1 = маскируется)</th>
  </tr>
  <tr> <th>Биты</th> <th>Маска</th> <th>Описание</th> </tr>
  <tr> <td class="center">0</td> <td class="center">IM</td> <td>Неверная операция</td> </tr>
  <tr> <td class="center">1</td> <td class="center">DM</td> <td>Ненормализованный операнд</td> </tr>
  <tr> <td class="center">2</td> <td class="center">ZM</td> <td>Деление на ноль</td> </tr>
  <tr> <td class="center">3</td> <td class="center">OM</td> <td>Переполнение</td> </tr>
  <tr> <td class="center">4</td> <td class="center">UM</td> <td>Исчезновение порядка</td> </tr>
  <tr> <td class="center">5</td> <td class="center">PM</td> <td>Точность</td> </tr>
  <tr> <td class="center">6</td> <td class="center">&nbsp;</td> <td>Зарезервировано</td> </tr>
  <tr> <td class="center">7</td> <td class="center">&nbsp;</td> <td>Зарезервировано</td> </tr>
  <tr> <td class="center">8-9</td> <td class="center">PC</td> <td>Управление точностью (1)</td> </tr>
  <tr> <td class="center">10-11</td> <td class="center">RC</td> <td>Управление округлением (2)</td> </tr>
  <tr> <td class="center">12</td> <td class="center">X</td> <td>Управление неопределенностью (3)</td> </tr>
  <tr> <td class="center">13-15</td> <td class="center">&nbsp;</td> <td>Зарезервировано</td> </tr>
</table>
<p class="center">
Фиг. 7.7 Формат управляющего слова INTEL 8087
<dir>
<pre>
(1) Управление точностью:
    00 = 24 бита
    01 =(зарезервировано)
    10 = 53 бита
    11 = 64 бита
(2) Управление округлением:
    00 = Округление до ближайшего или четного
    01 = Округление в меньшую сторону
    10 = Округление в большую сторону
    11 = Обрезание к нулю
(3) Управление неопределенностью:
    0 = Прожективная
    1 = Афинитивная
</pre>
</dir>
<p>
Фиг. 7.7 Формат управляющего слова INTEL 8087
<p>
<p>
Процессор 8087 может регистрировать множество ситуаций появления ошибки, известных как особые
ситуации; он также может возбуждать прерывания, чтобы сообщить об этих ситуациях. В управляющем слове имеется группа бит, которая позволяет программисту определить, какие особые ситуации будут приводить к прерываниям, а какие будут обрабатываться другими способами. Эти биты известны как маски прерываний, так как они могут маскировать, или предотвращать, возникновение прерываний.
<p>
Необходимости разрешать прерывание в каждой из этих ситуаций нет. Сопроцессор 8087 имеет широкие возможности по обработке особых ситуаций, встроенных в него самого. Для любой возможной ситуации в микросхеме 8087 имеется способ обработки ее по умолчанию. Например, деление на нуль вызывает прерывание по особой ситуации, если она разрешена (немаскирована). Однако если программист не разрешил это прерывание, сопроцессор 8087 использует значение бесконечности, как результат деления на нуль. Это значение распространится через все оставшиеся вычисления, давая результат, непосредственно показывающий, что во время работы возникла ошибка некоторого вида.
<p>
Иногда в какой-то из ваших программ, использующих плавающую точку, может оказаться необходимым
обрабатывать особую ситуацию сразу же, как она возникает; и тогда у вас возникает желание заменить обработчик прерываний вашей собственной подпрограммой, обрабатывающей особые ситуации. В IBM PC вывод прерывания по особой ситуации от микросхемы 8087 подключен ко входу немаскируемого прерывания NMI (Non Maskable Interrupt). Это то же самое прерывание, которое сигнализирует об ошибке четности.
<p>
В качестве примера особой ситуации рассмотрим упомянутое выше переполнение стека. Если программа помещает в стек девятый объект, сопроцессор 8087 отвечает прерыванием по особой ситуации. Если это прерывание не разрешено, сопроцессор 8087 отмечает операцию как недействительную и дает результат со специальным значением, известным как NAN (Not A Number, не
число). Если вы собираетесь выполнять сложные вычисления, требующие более восьми позиций стека, то можете выгодно использовать прерывание по этой особой ситуации. Когда возникает переполнение стека, обработчик этого прерывания может удалить нижние элементы стека, используя команды записи. Затем программа освобождает эти позиции стека для дальнейшего использования. Существует также и соответствующее прерывание по исчерпыванию стека, которое возникает при использовании пустой позиции стека; подпрограмма обработки прерывания может обрабатывать и эту ситуацию: она может восстановить прежнее состояние стека из области сохранения.
<p>
Далее мы увидим, что микросхема 8087 содержит информацию о своем состоянии, что делает возможным обработать особые ситуации в обработчике прерываний. Микросхема 8087 имеет исчерпывающую информацию о команде, которая вызвала особую ситуацию.

<p><div align="center"><a href="../index.html"><img src="../images/index.gif" border=0 alt=""></a></div><p></p>

</body>
</html>
