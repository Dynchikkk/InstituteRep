<html><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">



<body background="../images/bgrwhite.gif"><head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
 <TITLE>Дэвид Дж. Брэдли</TITLE>
</head>


<h3>4.9.5. Проверки кода условия</h3>

<p>
Первая группа команд условного перехода проверяет текущее состояние регистра флагов. Затем в зависимости от кодов условия команда делает переход (или не делает). Команды условного перехода не устанавливают флаги, а только проверяют их текущее состояние. Ранее рассмотренные  арифметические и логические команды устанавливают флаги. В последующих примерах предположим, что команда сравнения CMP уже установила флаги.
<p>
На Фиг.4.29 показаны команды условного перехода и проверяемые ими флаги. В строках рисунка перечислены команды условного перехода, а в пяти колонках показано состояние флагов. Буква X в любой позиции означает, что команда не проверяет флаг. Цифра 0 означает, что этот флаг должен быть сброшен, чтобы условие было выполнено и переход произошел. Цифра 1 означает, что флаг должен быть установлен, чтобы переход произошел. Некоторые элементы таблицы показывают выражение, которое должно быть истинно, чтобы переход произошел. Так сделано для арифметических переходов, и мы обсудим их далее более подробно.
<p>
На Фиг.4.29 условные переходы разделены на три группы: непосредственно проверяющие один из
флагов; делающие арифметическое сравнение без знака; делающие арифметическое сравнение со знаком.
<p>
На Фиг.4.29а показана проверка отдельных флагов. Условный переход может проверить каждый из этих
пяти флагов непосредственно на 0 или 1. Проверка флага переноса показана на рисунке в группе арифметики без знака, поскольку она имеет еще и арифметический смысл. Заметим, что многие команды условного перехода имеют более одной мнемоники, если даже выполняется одна и та же проверка. Например, проверку флага нуля осуществляет команда JZ (переход, если результат операции равен нулю). Однако команда JE (переход, если равно) также порождает ту же команду.
Следующая последовательность поясняет смысл этого:
<dir>
<pre>
<b>
CMP AX, BX
JE LABEL
</b>
</pre>
</dir>
<p>
Команда CMP вычитает содержимое регистра BX из содержимого регистра AX, устанавливая флаги в соответствии с результатом. Так как результат нулевой, если оба операнда равны, флаг нуля показывает равенство. Аналогично, команда JNZ (переход, если не нуль) идентичен команде JNE (переход, если не равно). Команда JP (переход по четности) - то же самое, что и команда JPE (переход при наличии четности); команда JNP (переход по нечетности) - то же самое, что команда JPO (переход при отсутствии четности).
<p>
<table align="center">
  <tr>
    <TH class="center">&nbsp;</th>
    <TH class="center" colspan="5">Флаги условного перехода</th>
    <TH class="center">&nbsp;</th>
  </tr>
  <tr>
    <TH class="center">Команды</th>
    <TH class="center">OF</th>
    <TH class="center">CY</th>
    <TH class="center">Z</th>
    <TH class="center">P</th>
    <TH class="center">S</th>
    <TH class="center">Комментарий
  </tr>
  <tr>
    <TH class="center" colspan="7">(a) Проверка флага</th>
  </tr>
  <tr>
    <td class="center">JE/JZ</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">1</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JNE/JNZ</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">0</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JP/JPE</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">1</td>
    <td class="center">x</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JNP/JPO</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">0</td>
    <td class="center">x</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JO</td>
    <td class="center">1</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JNO</td>
    <td class="center">0</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JS</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">1</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JNS</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">0</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <TH class="center" colspan="7">(b) Арифметика со знаком</th>
  </tr>
  <tr>
    <td class="center">JL/JNGE</td>
    <td class="center">a</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">b</td>
    <td class="center">a NEQ b</td>
  </tr>
  <tr>
    <td class="center">JNL/JGE</td>
    <td class="center">a</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">b</td>
    <td class="center">a = b</td>
  </tr>
  <tr>
    <td class="center">JLE/JNG</td>
    <td class="center">a</td>
    <td class="center">x</td>
    <td class="center">1</td>
    <td class="center">x</td>
    <td class="center">b</td>
    <td class="center">Z OR (A NEQ B)</td>
  </tr>
  <tr>
    <td class="center">JNLE/JG</td>
    <td class="center">a</td>
    <td class="center">x</td>
    <td class="center">0</td>
    <td class="center">x</td>
    <td class="center">b</td>
    <td class="center">&(NOT Z) AND (a=b)</td>
  </tr>
  <tr>
    <TH class="center" colspan="7">(c) беззнаковая арифметика</th>
  </tr>
  <tr>
    <td class="center">JB/JNAE/JC</td>
    <td class="center">x</td>
    <td class="center">1</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">1</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JNB/JAE/JN</td>
    <td class="center">x</td>
    <td class="center">0</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">&nbsp;</td>
  </tr>
  <tr>
    <td class="center">JBE/JNA</td>
    <td class="center">x</td>
    <td class="center">1</td>
    <td class="center">1</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">CY OR Z</td>
  </tr>
  <tr>
    <td class="center">JNBE/JA</td>
    <td class="center">x</td>
    <td class="center">0</td>
    <td class="center">0</td>
    <td class="center">x</td>
    <td class="center">x</td>
    <td class="center">(NOT CY) AND (NOT Z)</td>
  </tr>

</table>
<p class="center">     
Фиг. 4.29 Проверка флагов перехода по условию
<p>
Следующую группу команд условного перехода на Фиг.4.29b  составляют арифметические сравнения со
знаком. Существуют четыре условия, которые могут быть проверены: меньше (JL), меньше или равно (JLE), больше (JG), больше или равно (JGE). Другие четыре мнемоники - отрицания этих четырех. В
случае арифметики со знаком ассемблер использует мнемонику в названии команд &quot;меньше&quot; (less) и &quot;больше&quot; (greater). Далее мы увидим, что для арифметики без знакаассемблер использует мнемонику &quot;выше&quot; (above) и &quot;ниже&quot; (below).
<p>
Арифметические выражения можно понять, используя их вместе с командой CMP. Например,
<dir>
<pre>
<b>
CMP    AX,BX
JL     LABEL
</b>
</pre>
</dir>
<p>
Преход произойдет, если содержимое регистра AX меньше содержимого регистра BX. Вы можете читать
комбинацию команд сравнения и условного перехода вместе, как один оператор: операнд результата встречается первым, затем идет условный оператор, а за ним следует исходный операнд. Другой
пример:
<dir>
<pre>
<b>
CMP     CX,WORD_IN_MEMORY
JNLE    LABEL
</b>
</pre>
</dir>
<p>
- можно прочитать так: &quot;переход, если содержимое регистра CX не меньше, чем, или равен содержимому ячейки памяти WORD_IN_MEMORY. Этот прием можно использовать для определения значения любой команды арифметического перехода, учитывающей знак или не учитывающей.
<p>
Как показано на Фиг.4.29б арифметические сравнения со знаком проверяют одновременно несколько флагов. Фактически каждая из этих команд проверяет некоторую комбинацию флагов переполнения, знака, и, возможно, флага нуля. Например, в команде JL требуется, чтобы флаги переполнения и знака имели разные значения. Если они имеют одинаковое значение, первый операнд не был
меньше второго. Рассмотрим эту операцию несколько подробнее, чтобы понять работу арифметических сравнений.
<p>
Когда сравниваются два числа со знаком, возможны четыре комбинации флагов знака и переполнения.
Рассмотрим каждую из четырех комбинаций, чтобы определить какое состояние операндов привело к данному результату. Предположим, что в каждом случае флаги установила команда CMP, вычитавшая
два операнда.
<dir>
<pre>
<b>
Знак S = 0, переполнение O = 0.
</b>
</pre>
</dir>
<p>
Условие S=0 означает, что результат вычитания положителен. Условие O=0 означает, что переполнения не было, т.е. результат, представленный в дополнительном коде, правильный. Вычитание двух чисел, дающее положительный результат, показывает, что первое число больше второго, и поэтому имеет место соотношение &quot;больше&quot;. Однако вычитание двух равных чисел также дает положительный результат, так что условие S=0, O=0 означает &quot;больше
или равно&quot;.
<dir>
<pre>
<b>
S=1, O=0
</b>
</pre>
</dir>
<p>
В этом случае O=0 означает, что результат верен, а S=1 говорит о том, что он отрицателен. Чтобы получить отрицательный результат, большее число должно вычитаться из меньшего, и соотношение означает &quot;меньше&quot;.
<dir>
<pre>
<b>
S = 0, O = 1
</b>
</pre>
</dir>
<p>
Здесь O=1 показывает, что результат неверен, т.е. вышел за пределы возможностей разрядной сетки. Это значит, что сложение двух положительных чисел дало отрицательный результат или наоборот. В данном случае это сравнение показывает, что знак результата неверен; поэтому результат этого сравнения идентичен случаю, когда S=1, O=0, что означает &quot;меньше&quot;.
<dir>
<pre>
<b>
S = 1, O = 1
</b>
</pre>
</dir>
<p>
Снова O=1 говорит о том, что знак результата неверен. Поэтому вычитание должно было привести к очень большому положительному числу, и соотношение будет &quot;больше или равно&quot;.
<p>
В некоторых случаях также учитывается флаг нуля. Например, команда JLE выполняется, если условие есть &quot;меньше&quot; (знак и переполнение разные) или &quot;равно&quot; (флаг нуля равен 1). Эти три флага позволяют микропроцессору 8088 проверить все возможные комбинации чисел со знаком.
<p>
часть таблицы (Фиг.4.29c) показывает условия, проверяемые для арифметики без знака. Как
и в случае арифметики со знаком, существуют четыре возможные соотношения между операндами, которые может проверить микропроцессор. Для того чтобы отличить команды условного перехода ориентированные на беззнаковую арифметику от знаковой арифметики, используются слова &quot;выше&quot; и quot;ниже&quot; в названии команд. Вероятно, этим выражается точка зрения создателей набора команд, заключающаяся в том, что арифметика без знака будет использоваться в программах для вычисления адресов, а отрицательных адресов не бывает. &quot;Выше&quot; и &quot;ниже&quot; показывают расположение значения адресов внутри адресного пространства, в то время как &quot;больше&quot; и &quot;меньше&quot; говорит о соотношении чисел со знаком. Здесь важно, что выполняется именно та команда, которая указана в программе на языке ассемблера, независимо от типов сравниваемых операндов. Например, программа сравнивает два числа со знаком, а использует команду JA (переход, если выше). Микропроцессор выполняет условный переход в зависимости от соотношения двух чисел, считая их числами без знака, т.е. именно программист обязан выбрать правильную команду условного перехода.
<p>
Микропроцессор 8088 при сравнении двух чисел без знака учитывает только два флага. Флаг переноса
показывает, какое из чисел больше. Сравнение устанавливает флаг переноса, если первый операнд ниже второго или сбрасывает флаг переноса, если первый операнд либо выше, либо равен второму
операнду, и флаг нуля определяет, что в данном случае верно.
<p>
Сравнения без знака можно читать так же, как и сравнения со знаком. Например,
<dir>
<pre>
<b>
CMP     AX,BX
JA      LABEL
</b>
</pre>
</dir>
<p>
 - переход на метку LABEL происходит, если регистр AX выше регистра BX. Условный переход выполняется всегда, если объявленное соотношение существует между первым и вторым операндами предшествовавшей команды сравнения.

<p><div align="center"><a href="../index.html"><img src="../images/index.gif" border=0 alt=""></a></div><p></p>

</body>
</html>
