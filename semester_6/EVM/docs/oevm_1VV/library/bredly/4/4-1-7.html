<html><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">



<body background="../images/bgrwhite.gif">
<LINK REL="stylesheet" TYPE="text/css" HREF="../default.css">
<head>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
 <TITLE>Дэвид Дж. Брэдли</TITLE>
</head>



<h3>4.1.7. Перекодировка</h3>

<p>
Команда перекодировки XLAT преобразует информацию из одногопредставления в другое. Команда XLAT преобразует значение в регистре AL в другое значение, выбираемое из таблицы, на которую указывает регистр BX. На Фиг.4.4 схематически показано, как работает эта команда. Регистр BX вместе с выбранным сегментным регистром определяет точку начала таблицы перекодировки в памяти. К этому адресу таблицы команда прибавляет содержимое регистра AL, значение между 0 и 255.    Данные, расположенные по этому адресу, команда XLAT пересылает в регистр AL. Команда XLAT выполняет операцию просмотра таблицы.
<p>
Команду XLAT хорошо использовать при кодировании и декодировании текстовых данных. С помощью
этой команды программа может организовать простую замену кодов символов. В следующем примере десять символов кода ASCII от 0 до 9 перекодируются в целях передачи. Этот метод может использоваться в системе дляперекодировки информации, передаваемой из одной машины в другую. Когда данные принимаются, другая программа возвращает закодированные символы к их
первоначальному виду. На Фиг. 4.5 демонстрируется кодировка и декодировка.
<p>
На Фиг.4.5 изображены две таблицы перекодировки, одна для передачи, а другая для приема. Чтобы
передать значение 5, программа находит значение 5 в таблице передачи (а), из которой извлекает значение 6, которое передает. Когда это значение принимается, программа декодирования ищет 6 в таблице приема (b), чтобы перекодировать его в истинное значение 5.
<p>
На Фиг. 4.6 показана подпрограмма, которая производит это декодирование. Подпрограмма
перекодирования читает начальное значение из порта ввода-вывода, и возвращает кодированное или декодированное значение в вызывающую программу через регистр AL. Одна и та же программа выполняет как кодирование, так и декодирование, меняя таблицы кодировки.
<p>
С начала подпрограмма читает данные из вводного порта 40H в регистр AL. Затем она вычитает значение &quot;0&quot; в коде ASCII из значения данных, чтобы получить цифровое значение. Это означает, что символ &quot;0&quot; дает значение 0 в регистре AL, символ &quot;1&quot; дает 1, и т.д. Команда LDS загружает указатель нужной таблицы в пару регистров DS:BX. Загружая этот указатель из ячейки памяти - в<pre>
<tt>
Microsoft (R) Macro Assembler Version 5.00                  1/1/80 04:00:38
Фиг. 4.6 Пример перекодировки                                     Page  1-1
                         PAGE     ,132
                              TITLE    Фиг. 4.6 Пример перекодировки
0000                          CODE     SEGMENT
                              ASSUME   CS:CODE, DS:CODE

                              ; Эта программа вводит значение из порта 040H и
                              ; декодирует его, используя таблицу перекодировки.
                              ; Так как одна и та же программа используется как для
                              ; кодировки, так и декодировки, указатель TABLE_POINTER
                              ; указывает на соответсвующую таблицу перекодировки.
                              ; Вызывая подпрограмму, необходимо установить
                              ; этот указатель на соответствующую таблицу.
0000                          TRANSLATE PROC NEAR        ; Подпрограмма TRANSLATE
0000    E4 40                          IN    AL,040H     ; Ввод значения из порта
0002    2C 30                          SUB   AL,&quot;0&quot;      ; Значение относительно символа 0,
                                                         ; т.е. относительно начала таблицы
0004    C5 1E 000A R                   LDS   BX,TABLE_POINTER  ; (DS,BX) указывает на таблицу
0008    D7                             XLAT  XMIT_TABLE ; Перекодировка числа
0009    C3                             RET
000A    000E ---- R           TABLE_POINTER  DD  XMIT_TABLE
000E    35 37 39 31 33 36 38  XMIT_TABLE     DB  '5791368024'
        30 32 34
0018    37 33 38 34 39 30 35  RECV_TABLE     DB  '7384905162'
        31 36 32
0022                          TRANSLATE         ENDP
0022                          CODE    ENDS
                              END

                             Фиг. 4.6 Пример перекодировки
</tt>
</pre>
<p>
примере TABLE_POINTER - подпрограмма может использовать любую таблицу перекодировки. В этой программе имеются две табдицы, одна из них для передачи, названная XMIT_TABLE, которая соответствует Фиг.4.5(а), другая - таблица приема, названная RECV_TABLE, - соответствует Фиг.4.5(б). Перед вызовом подпрограммы головная программа должна записать нужный адресный
указатель в переменную TABLE_POINTER. Если головная программа принимает коды, она должна поместить адрес таблицы RECV_TABLE в переменную TABLE_POINTER. Заметим, что эта подпрограмма может проделать любую перекодировку, поскольку таблицу перекодировки назначает вызывающая программа.
<p>
Команда XLAT выполняет перекодировку по таблице, на которую указывает пара регистров DS:BX. В регистре AL находится значение между 0 и 9. Команда XLAT складывает это значение с содержимым указателя и загружает перекодированное значение в регистр AL. Команда RET возвращает управление в вызывающую программу. Другим обычным случаем использования команды XLAT является смена кода представления символов в одной машине на код представления в другой машине. IBM PC,
работает в коде ASCII, а  большинство машин фирмы IBM используют код EBCDIC (Extended Binary=Coded=Decimal Interchange Code - расширенный  двоично=кодированный десятичный код обмена
информации). Чтобы связываться с такими машинами, в программе надо перекодировать символы, и команда XLAT естественным образом подходит для этой функции.
<p>
Итак, команда XLAT является весьма мощным средством перекодировки байтовой или символьной
информации. Мощность этой команды делает ее редко используемой, так как возможность использовать ее преимущества возникает не часто. Однако помните об этой команде на тот случай, когда она окажется полностью оправданной.

<p><div align="center"><a href="../index.html"><img src="../images/index.gif" border=0 alt=""></a></div><p></p>

</body>
</html>
